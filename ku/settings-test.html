<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¾ç½®èœå•æµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: white;
        }
        .test-container {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .test-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #45a049;
        }
        .test-button.danger {
            background: #f44336;
        }
        .test-button.danger:hover {
            background: #da190b;
        }
        .test-result {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .nav-test {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            position: relative;
        }
        .settings-dropdown {
            display: inline-block;
            position: relative;
        }
        .settings-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(26, 26, 46, 0.95);
            border-radius: 15px;
            padding: 15px;
            width: 320px;
            z-index: 9999;
            display: none;
        }
        .settings-menu.active {
            display: block !important;
        }
        a {
            color: #4CAF50;
            text-decoration: none;
            padding: 10px 15px;
            display: inline-block;
            border-radius: 5px;
        }
        a:hover {
            background: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª è®¾ç½®èœå•åŠŸèƒ½æµ‹è¯•</h1>

        <div class="test-section">
            <h2>ğŸ“‹ æµ‹è¯•é¡¹ç›®</h2>
            <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•è®¾ç½®èœå•çš„å„é¡¹åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
        </div>

        <div class="test-section">
            <h3>ğŸ›ï¸ è®¾ç½®èœå•æµ‹è¯•</h3>
            <div class="nav-test">
                <div class="settings-dropdown">
                    <a href="#" id="settings-toggle">âš™ï¸ è®¾ç½®</a>
                    <div class="settings-menu" id="settings-menu">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <h3>è®¾ç½®èœå•</h3>
                            <button id="close-settings" style="position: absolute; top: 10px; right: 10px; background: none; border: none; color: white; cursor: pointer;">âœ–</button>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <div>ğŸ¨ ä¸»é¢˜: <select id="theme-select"><option>æš—è‰²</option><option>äº®è‰²</option></select></div>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <div>ğŸ“ å­—ä½“: <select id="font-select"><option>é»˜è®¤</option><option>å¤§å­—ä½“</option></select></div>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label>
                                <input type="checkbox" id="effects-toggle"> ğŸ† ç‰¹æ•ˆå¼€å…³
                            </label>
                        </div>
                        <button style="width: 100%; padding: 10px; background: #4CAF50; color: white; border: none; border-radius: 5px;">ä¿å­˜è®¾ç½®</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ åŠŸèƒ½æµ‹è¯•</h3>
            <button class="test-button" onclick="testSettingsToggle()">æµ‹è¯•è®¾ç½®èœå•åˆ‡æ¢</button>
            <button class="test-button" onclick="testElementsExist()">æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨</button>
            <button class="test-button" onclick="testEventListeners()">æµ‹è¯•äº‹ä»¶ç›‘å¬å™¨</button>
            <button class="test-button danger" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
            <div id="test-results" class="test-result"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š æ§åˆ¶å°æµ‹è¯•</h3>
            <p>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å°ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
            <ul>
                <li><code>testSettingsToggle()</code> - æµ‹è¯•è®¾ç½®èœå•åˆ‡æ¢</li>
                <li><code>document.getElementById('settings-menu')</code> - æ£€æŸ¥è®¾ç½®èœå•å…ƒç´ </li>
                <li><code>emergencyRepair()</code> - è¿è¡Œç´§æ€¥ä¿®å¤ï¼ˆå¦‚æœå¯ç”¨ï¼‰</li>
            </ul>
        </div>
    </div>

    <script>
        let testResults = [];

        function log(message) {
            testResults.push(`[${new Date().toLocaleTimeString()}] ${message}`);
            updateResults();
            console.log(message);
        }

        function updateResults() {
            document.getElementById('test-results').textContent = testResults.join('\n');
        }

        function clearResults() {
            testResults = [];
            updateResults();
        }

        function testElementsExist() {
            log('ğŸ” æ£€æŸ¥å…³é”®å…ƒç´ æ˜¯å¦å­˜åœ¨...');

            const elements = [
                { id: 'settings-toggle', name: 'è®¾ç½®æŒ‰é’®' },
                { id: 'settings-menu', name: 'è®¾ç½®èœå•' },
                { id: 'close-settings', name: 'å…³é—­æŒ‰é’®' }
            ];

            elements.forEach(elem => {
                const element = document.getElementById(elem.id);
                if (element) {
                    log(`âœ… ${elem.name} å­˜åœ¨`);
                } else {
                    log(`âŒ ${elem.name} ä¸å­˜åœ¨`);
                }
            });
        }

        function testSettingsToggle() {
            log('ğŸ›ï¸ æµ‹è¯•è®¾ç½®èœå•åˆ‡æ¢åŠŸèƒ½...');

            const settingsToggle = document.getElementById('settings-toggle');
            const settingsMenu = document.getElementById('settings-menu');

            if (!settingsToggle || !settingsMenu) {
                log('âŒ å…³é”®å…ƒç´ ç¼ºå¤±');
                return;
            }

            const isVisible = settingsMenu.style.display === 'block' || settingsMenu.classList.contains('active');
            log(`ğŸ“Š å½“å‰èœå•çŠ¶æ€: ${isVisible ? 'æ˜¾ç¤º' : 'éšè—'}`);

            // æ¨¡æ‹Ÿç‚¹å‡»
            settingsToggle.click();

            setTimeout(() => {
                const newState = settingsMenu.style.display === 'block' || settingsMenu.classList.contains('active');
                log(`ğŸ“Š ç‚¹å‡»åèœå•çŠ¶æ€: ${newState ? 'æ˜¾ç¤º' : 'éšè—'}`);
                log(`âœ… åˆ‡æ¢åŠŸèƒ½${newState !== isVisible ? 'æ­£å¸¸' : 'å¯èƒ½å¼‚å¸¸'}`);
            }, 100);
        }

        function testEventListeners() {
            log('ğŸ‘‚ æµ‹è¯•äº‹ä»¶ç›‘å¬å™¨...');

            const settingsToggle = document.getElementById('settings-toggle');
            if (settingsToggle) {
                const hasClickHandler = settingsToggle.onclick !== null;
                const hasEventListeners = getEventListeners && getEventListeners(settingsToggle).click;

                log(`ğŸ“Š onclickå¤„ç†å™¨: ${hasClickHandler ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`);
                log(`ğŸ“Š äº‹ä»¶ç›‘å¬å™¨: ${hasEventListeners ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨æˆ–æ— æ³•æ£€æµ‹'}`);
            }
        }

        // ç®€å•çš„è®¾ç½®èœå•åŠŸèƒ½å®ç°
        function initializeSettings() {
            log('ğŸš€ åˆå§‹åŒ–è®¾ç½®èœå•...');

            const settingsToggle = document.getElementById('settings-toggle');
            const settingsMenu = document.getElementById('settings-menu');
            const closeSettings = document.getElementById('close-settings');

            if (settingsToggle && settingsMenu) {
                settingsToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    log('ğŸ–±ï¸ è®¾ç½®æŒ‰é’®è¢«ç‚¹å‡»');

                    const isActive = settingsMenu.classList.contains('active');
                    if (isActive) {
                        settingsMenu.classList.remove('active');
                        log('âŒ èœå•å·²éšè—');
                    } else {
                        settingsMenu.classList.add('active');
                        log('âœ… èœå•å·²æ˜¾ç¤º');
                    }
                });

                if (closeSettings) {
                    closeSettings.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        settingsMenu.classList.remove('active');
                        log('âŒ é€šè¿‡å…³é—­æŒ‰é’®éšè—èœå•');
                    });
                }

                // ç‚¹å‡»å¤–éƒ¨å…³é—­
                document.addEventListener('click', function(e) {
                    if (!settingsToggle.contains(e.target) && !settingsMenu.contains(e.target)) {
                        if (settingsMenu.classList.contains('active')) {
                            settingsMenu.classList.remove('active');
                            log('âŒ é€šè¿‡ç‚¹å‡»å¤–éƒ¨éšè—èœå•');
                        }
                    }
                });

                log('âœ… è®¾ç½®èœå•åˆå§‹åŒ–å®Œæˆ');
            } else {
                log('âŒ è®¾ç½®èœå•åˆå§‹åŒ–å¤±è´¥ - å…ƒç´ ç¼ºå¤±');
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆ');
            initializeSettings();
        });

        // å…¨å±€æµ‹è¯•å‡½æ•°
        window.testSettingsToggle = testSettingsToggle;
        window.testElementsExist = testElementsExist;
        window.testEventListeners = testEventListeners;
    </script>
</body>
</html>